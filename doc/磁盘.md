# 端口以及寄存器用途
## 0x1F0/0x170(data)
```数据缓冲```
>data 寄存器在名字上我们就知道它是负责管理数据的,它相当于数据的门,数据能进,也能出,所以其
作用是读取或写入数据。数据的读写还是越快越好,所以此寄存器较其他寄存器宽一些,16 位(已经很不
错了,表中其他寄存器都是 8 位的)
 。在读硬盘时,硬盘准备好的数据后,硬盘控制器将其放在内部的缓冲
区中,不断读此寄存器便是读出缓冲区中的全部数据。在写硬盘时,我们要把数据源源不断地输送到此端口,
数据便被存入缓冲区里,硬盘控制器发现这个缓冲区中有数据了,便将此处的数据写入相应的扇区中。

## 0x1F0/0x171(error/feature)
```读时存放error/写时存放一些写的参数```
>读硬盘时,端口 0x171 或 0x1F1 的寄存器名字叫 Error 寄存器,只在读取硬盘失败时有用,里面才会
记录失败的信息,尚未读取的扇区数在 Sector count 寄存器中。在写硬盘时,此寄存器有了别的用途,所
以有了新的名字,叫 Feature 寄存器。有些命令需要指定额外参数,这些参数就写在 Fea ture 寄存器中。
强调一下,error 和 feature 这两个名字指的是同一个寄存器,只是因为不同环境下有不同的用途,为了区
别这两种用途,所以在相应环境下有不同的名字。这两个寄存器都是 8 位宽度。

## 0x1F2/0x172(Sector count)
```存放待操作扇区(读返回结果时也存放未读取扇区)```
>Sector count 寄存器用来指定待读取或待写入的扇区数。硬盘每完成一个扇区,就会将此寄存器的值
减 1,所以如果中间失败了,此寄存器中的值便是尚未完成的扇区。这是 8 位寄存器,最大值为 255,若
指定为 0,则表示要操作 256 个扇区。

## 0x1F3~0x1F5/0x173~0x175(LAB low,LAB mid,LAB hight)
```存放地址```
>LBA low、LBA mid、LBA high 三个,它们三个
都是 8 位宽度的。 LBA low 寄存器用来存储 28 位地址的第 0~7 位, LBA mid 寄存器用来存储第 8~15 位,
LBA high 寄存器存储第 16~23 位。其他四位存放在device寄存器

## 0x1F6/0x176(device)
```存放杂项```
>vice 寄存器是个杂项,它的宽度是 8 位。在此寄存器的低 4 位用来存储 LBA 地址
的第 24~27 位。结合上面的三个 LBA 寄存器。第 4 位用来指定通道上的主盘或从盘,0 代表主盘,1 代
表从盘。第 6 位用来设置是否启用 LBA 方式, 1 代表启用 LBA 模式, 0 代表启用 CHS 模式。另外的两位:
第 5 位和第 7 位是固定为 1 的,称为 MBS 位
 


## 0x1F7/0x177(status/Command)
```status(读):存放状态信息，command(写)：存放存储让硬盘执行的命令```


 
 # 磁盘操作的命令
 * (1)identify:0xEC,即硬盘识别。
 * (2)read sector:0x20,即读扇区。
* (3)write sector:0x30,即写扇区。


# 硬盘操作的大致顺序(不是强制的)
    (1).先选择通道,往该通道的 sector count 寄存器中写入待操作的扇区数。
    (2).往该通道上的三个 LBA 寄存器写入扇区起始地址的低 24 位。
    (3).往 device 寄存器中写入 LBA 地址的 24~27 位,并置第 6 位为 1,使其为 LBA 模式,设置第 4位,选择操作的硬盘(master 硬盘或 slave 硬盘)。
    (4).往该通道上的 command 寄存器写入操作命令。
    (5).读取该通道上的 status 寄存器,判断硬盘工作是否完成。
    (6).如果以上步骤是读硬盘,进入下一个步骤。否则,完工。
    (7).将硬盘数据读出。

# 数据差传输的方式
    (1).无条件传送方式。
    (2).查询传送方式。
    (3).中断传送方式。
    (4).直接存储器存取方式(DMA)。
    (5).I/O 处理机传送方式。 

我们实现的操作系统主要采用2/3